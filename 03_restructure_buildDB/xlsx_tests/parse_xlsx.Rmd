
## rough idea: 

0. Check wether its an investigation sheet or loop over sheets
1. focus on investigation only
2. subset into sections?
3. JSON-like
  - column 1 = keys
  - column(s) 2:n = values as a list
  
## TODOs 

- input (xlsx) from CLI
- output to Rdata (?)


```{r}
### If package "readxl" is not installed, install it.
if(!require("readxl", quietly = TRUE)){install.packages("readxl")}

### load the package
library(readxl)

### read the xlsx sheet
invdata <- as.data.frame(read_xlsx("../../02_retrieve_readFromGitLab/gitlab_apitests/project_isaInvestigation.xlsx", col_names = F, sheet = 1))

### TODO loop over all sheets and find the correct one

### subset to investigation only
investigation_data <- invdata[grepl("^investigation",  invdata[, 1], ignore.case = T), ]

### first column as row names
rownames(investigation_data) <- investigation_data[,1]
investigation_data2 <- investigation_data[,-1]

### extract investigation subsections (some redundancy with above)

inv_sections <- which(grepl("^INVESTIGATION",  row.names(investigation_data2), ignore.case = F))

investigation_list <- list()
for(i in 1:length(inv_sections))
{
  
  if(i == length(inv_sections))
    {
    section_range <- (inv_sections[i] + 1):nrow(investigation_data2)
    }else{
    section_range <- (inv_sections[i] + 1):(inv_sections[i+1] - 1)  
    }
  
  current_section <- investigation_data2[section_range, ]
  
  ### transpose / pivot data to transform into list
  current_section_transposed <- as.data.frame(t(current_section))
  
  ### extract current section name
  current_section_name <- row.names(investigation_data2)[inv_sections[i]]
  
  ### transform to named list, omitting NAs
  investigation_list[[current_section_name]] <- lapply(current_section_transposed, function(v){v[!is.na(v)]})
  
}



```




